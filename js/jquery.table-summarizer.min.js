/*
 *	Title:		jquery.table-summarizer (tableSummarizer)
 *	Homepage:	https://github.com/benichu/jquery.table-summarizer
 *	Build:		1.0.0-20120712
 *	Copyright:	(c)2012: Benjamin Thouret <ben@2ret.com>
 *	License:	MIT, https://github.com/benichu/jquery.table-summarizer/LICENSE-MIT
 *
 */
jQuery(function(){return $.tableSummarizer=function(e,t){var n,r,i,s,o=this;return i="waiting",this.settings={},this.$element=$(e),this.setState=function(e){return i=e},this.getState=function(){return i},this.getSetting=function(e){return this.settings[e]},this.callSettingFunction=function(e,t){return t==null&&(t=[]),this.settings[e].apply(this,t)},n=function(e){var t;return r("Add summary row"),o.$row=e.find("tr:last").clone(!0),o.settings.position==="after"?o.$row.appendTo(e):o.$row.appendTo(e),o.$row.addClass(o.settings.summaryCssClass),t=o.settings,o.$row.find("td").each(function(){return $(this).html(""),$(this).find(t.summarizableAttr).attr(t.summarizableAttr,"")})},s=function(e){var t,n,i,s,u,a,f,l,c;t=o.settings.cssClass,r("Summarize: "+t),c=[];for(f=0,l=t.length;f<l;f++)n=t[f],u=0,i=o.settings,a=e.find("tr:not(."+o.settings.summaryCssClass+")"),a.find("["+o.settings.summarizableAttr+"]."+n+", ."+n+" ["+o.settings.summarizableAttr+"]").each(function(){var e;return $(this).attr(i.summarizableAttr)?e=parseFloat($(this).attr(i.summarizableAttr)):e=0,u+=e}),s=e.find("tr."+o.settings.summaryCssClass+" td."+n),r(""+n+": "+u),o.settings.showValue&&s.html(u),c.push(s.attr(o.settings.summarizableAttr,u));return c},r=function(e){if(o.settings.debug)return typeof console!="undefined"&&console!==null?console.log(e):void 0},this.init=function(){return this.settings=$.extend({},this.defaults,t),this.setState("waiting"),this.$element.length?(r("Element is defined."),this.$tbodies=this.$element.find("tbody"),this.$tbodies.each(function(){return n($(this)),s($(this))}),this.setState("ready"),this.callSettingFunction("onReady",[this.$element])):(this.setState("error"),this.callSettingFunction("onError",[this.$element]))},this.init(),this},$.tableSummarizer.prototype.defaults={debug:!1,summaryCssClass:"summary",showValue:!0,cssClass:["duration"],summarizableAttr:"data-minute",position:"after",onReady:function(){},onError:function(){}},$.fn.tableSummarizer=function(e){return this.each(function(){var t;if($(this).data("tableSummarizer")===void 0)return t=new $.tableSummarizer(this,e),$(this).data("tableSummarizer",t)})}});